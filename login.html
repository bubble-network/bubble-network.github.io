<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<title>Bubble login page</title>
	<link rel="stylesheet" href="styles.css">
</head>

<body>
	<h1>Login</h1>
	<fieldset>
		<form>
			<h2>Nick</h2>
			<input type="text" id="nick" />

			<h2>Password</h2>
			<input type="password" id="pass" />
			<p>
				<input type="button" value="Login" onclick="getCookie();" />
			</p>
		</form>
	</fieldset>
	<a href="signup.html">Sign Up</a>

	<script
		src="https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/crypto-js/2.5.3-crypto-sha1.js"></script>
	<script src="defs.js"></script>
	<script>
		function getCookie() {
			const nick = document.getElementById("nick").value;
			const pass = document.getElementById("pass").value;

			const auth = "Basic " + btoa(nick + ":" + Crypto.SHA1(pass))
			const request = new Request(
				apiUrl + "login",
				{
					headers: new Headers({ Authorization: auth }),
					credentials: "include"
				}
			);
			fetch(request).then(res => {
				if (res.status == 202) {
					window.location.href = "main.html";
				} else {
					res.text().then((v) => alert(v));
				}
			}).catch(e => console.log(e));
		}
	</script>
</body>

</html>