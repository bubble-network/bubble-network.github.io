<h1>Main page</h1>

<h2>Bubbles</h2>
<input type="button" value="Get Bubbles" onclick="getbubbles();"/>
<form>
	<input id="name" type="text"/>
	<input type="button" value="New Bubble" onclick="createbubble();"/>
</form>

<ul id="bubbles"></ul>

<h2>Chats</h2>
<ul id="chats"></ul>

<h2>Profile</h2>
<ul id="profile"></ul>

<script>
	const url = "https://api.bubble-network.com/";

	function bubble(b) {
		return `<li>${b.Name}</li>`;
	}

	function getbubbles() {
		const request = new Request(
			url + "bubbles?type=user",
			{ credentials: "include" }
		);
		fetch(request).then(res => {
			if(res.status == 200) {
				let bubbles = document.getElementById("bubbles");

				// Get bubbles
				res.json().then(bs => {
					bubbles.innerHTML = bs.map(b => bubble(b)).join("\n")
				});

				// Get chats
			} else {
				res.text().then(v => alert(v));
			}
		}).catch(e => console.log(e));
	}

	function createbubble() {
		const name = document.getElementById("name").value;

		const request = new Request(
			url + "bubbles",
			{ 
				method: "POST",
				credentials: "include"
			}
		);
		fetch(request).then(res => {
			if(res.status == 200) {
				res.text().then(t => console.log(t));
				// Get bubbles
				// Get chats
			} else {
				res.text().then(v => alert(v));
			}
		}).catch(e => console.log(e));
	}

	function profile(p) {
		return `<li><strong>Name: </strong>${p.Name}</li>
			<li><strong>Username: </strong>$p.Nick</li>
			<li><strong>Email: </strong>$p.Email</li>
			<li><strong>Default bubble thickness: </strong>$p.Config.DefaultBubbleThickness</li>
			<li><strong>Auto join new bubbles: </strong>$p.Config.AutoJoinBubbles</li>`;
	}

	function getprofile() {
		const name = document.getElementById("profile").value;

		const request = new Request(
			url + "myprofile",
			{ credentials: "include" }
		);
		fetch(request).then(res => {
			if(res.status == 200) {
				res.json().then(p => {
					profile.innerHTML = profile(p);
				});
			} else {
				res.text().then(v => alert(v));
			}
		}).catch(e => console.log(e));
	}

	// Connect websocket
</script>

